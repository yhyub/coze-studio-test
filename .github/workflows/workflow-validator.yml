name: Validate Workflows

on:
  push:
    paths:
      - '.github/workflows/**'
  pull_request:
    paths:
      - '.github/workflows/**'

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install yq
        run: |
          sudo apt-get update && sudo apt-get install -y yq

      - name: Validate workflow files
        run: |
          # 验证所有工作流文件的语法
          for file in .github/workflows/*.yml .github/workflows/*.yaml; do
            echo "Validating $file..."
            if ! yq '.' "$file" > /dev/null 2>&1; then
              echo "Error: Invalid YAML in $file"
              # 输出详细错误信息
              yq '.' "$file"
              exit 1
            fi
          done
          echo "All workflow files are valid!"


name: æœ€ç»ˆå®Œæ•´æµ‹è¯•å·¥ä½œæµ
on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  # æµ‹è¯•1ï¼šåŸºç¡€ç¯å¢ƒæµ‹è¯•
  test-1-environment:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: æ£€æŸ¥ä»£ç 
        uses: actions/checkout@v5

      - name: åŸºç¡€ç¯å¢ƒæµ‹è¯•
        run: |
          echo "âœ… åŸºç¡€ç¯å¢ƒæµ‹è¯•å¼€å§‹"
          echo "GitHub SHA: ${{ github.sha }}"
          echo "è¿è¡Œç¯å¢ƒ: ${{ runner.os }}"
          echo "Node.jsç‰ˆæœ¬: $(node --version 2>/dev/null || echo 'æœªå®‰è£…')"
          echo "Pythonç‰ˆæœ¬: $(python --version 2>/dev/null || echo 'æœªå®‰è£…')"
          echo "Goç‰ˆæœ¬: $(go version 2>/dev/null || echo 'æœªå®‰è£…')"
          echo "âœ… åŸºç¡€ç¯å¢ƒæµ‹è¯•å®Œæˆï¼"

  # æµ‹è¯•2ï¼šæ•°æ®è·å–æ¨¡æ‹Ÿ
  test-2-data-acquisition:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: æ£€æŸ¥ä»£ç 
        uses: actions/checkout@v5

      - name: æ•°æ®è·å–æ¨¡æ‹Ÿ
        run: |
          echo "âœ… æ•°æ®è·å–æµ‹è¯•å¼€å§‹"
          # æ¨¡æ‹Ÿæ•°æ®è·å–è¿‡ç¨‹
          sleep 3
          echo "ğŸ“Š æ¨¡æ‹Ÿè·å–åˆ°çš„æ•°æ®ï¼š"
          echo "   - ç”¨æˆ·æ•°ï¼š1000"
          echo "   - è®¿é—®é‡ï¼š5000"
          echo "   - è½¬åŒ–ç‡ï¼š2.5%"
          echo "âœ… æ•°æ®è·å–æµ‹è¯•å®Œæˆï¼"

  # æµ‹è¯•3ï¼šå¤šç¯å¢ƒéƒ¨ç½²æµ‹è¯•
  test-3-multi-environment:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    strategy:
      matrix:
        environment: [development, staging, production]
    steps:
      - name: æ£€æŸ¥ä»£ç 
        uses: actions/checkout@v5

      - name: å¤šç¯å¢ƒéƒ¨ç½²æµ‹è¯•
        run: |
          echo "âœ… å¤šç¯å¢ƒéƒ¨ç½²æµ‹è¯•å¼€å§‹"
          echo "ğŸ“¦ éƒ¨ç½²åˆ°ç¯å¢ƒï¼š${{ matrix.environment }}"
          # æ¨¡æ‹Ÿéƒ¨ç½²è¿‡ç¨‹
          sleep 2
          echo "âœ… æˆåŠŸéƒ¨ç½²åˆ°${{ matrix.environment }}ç¯å¢ƒï¼"

  # æµ‹è¯•4ï¼šè‡ªåŠ¨åŒ–ä¿®å¤åŠŸèƒ½æµ‹è¯•
  test-4-auto-fix:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: æ£€æŸ¥ä»£ç 
        uses: actions/checkout@v5

      - name: è‡ªåŠ¨åŒ–ä¿®å¤åŠŸèƒ½æµ‹è¯•
        run: |
          echo "âœ… è‡ªåŠ¨åŒ–ä¿®å¤åŠŸèƒ½æµ‹è¯•å¼€å§‹"
          # æ¨¡æ‹Ÿè‡ªåŠ¨åŒ–ä¿®å¤è¿‡ç¨‹
          echo "ğŸ” æ£€æµ‹åˆ°1ä¸ªå·¥ä½œæµè¯­æ³•é”™è¯¯"
          sleep 1
          echo "ğŸ”§ æ­£åœ¨ä¿®å¤å·¥ä½œæµè¯­æ³•é”™è¯¯..."
          sleep 2
          echo "âœ… æˆåŠŸä¿®å¤1ä¸ªå·¥ä½œæµè¯­æ³•é”™è¯¯ï¼"

  # æµ‹è¯•5ï¼šæœ€ç»ˆéªŒè¯
  test-5-final-verification:
    runs-on: ubuntu-latest
    needs: [test-1-environment, test-2-data-acquisition, test-3-multi-environment, test-4-auto-fix]
    permissions:
      contents: read
    steps:
      - name: æ£€æŸ¥ä»£ç 
        uses: actions/checkout@v5

      - name: æœ€ç»ˆéªŒè¯
        run: |
          echo "âœ… æœ€ç»ˆéªŒè¯å¼€å§‹"
          echo "ğŸ“‹ æ‰€æœ‰æµ‹è¯•ç»“æœæ±‡æ€»ï¼š"
          echo "   - åŸºç¡€ç¯å¢ƒæµ‹è¯•ï¼šâœ… é€šè¿‡"
          echo "   - æ•°æ®è·å–æµ‹è¯•ï¼šâœ… é€šè¿‡"
          echo "   - å¤šç¯å¢ƒéƒ¨ç½²æµ‹è¯•ï¼šâœ… é€šè¿‡"
          echo "   - è‡ªåŠ¨åŒ–ä¿®å¤æµ‹è¯•ï¼šâœ… é€šè¿‡"
          echo "âœ… æ‰€æœ‰æµ‹è¯•å‡å·²é€šè¿‡ï¼"

      - name: è¾“å‡ºæœ€ç»ˆç»“æœ
        run: |
          echo "ğŸ‰ æœ€ç»ˆå®Œæ•´æµ‹è¯•å·¥ä½œæµè¿è¡ŒæˆåŠŸï¼"
          echo "ğŸ“… è¿è¡Œæ—¶é—´ï¼š$(date)"
          echo "ğŸ” ä»“åº“ï¼š${{ github.repository }}"
          echo "âœ… æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹å‡å·²é€šè¿‡ï¼"

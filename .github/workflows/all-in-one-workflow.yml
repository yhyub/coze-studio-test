name: All-in-One Workflow Fixer
# This workflow integrates all workflow execution logic
# It works seamlessly with the main configuration file eawsrdfchgvjhrrdfgh.yml
# All configurations are fully integrated and redundant-free

on:
  workflow_dispatch:
    inputs:
      fix-type:
        description: 'Type of fix to apply'
        required: true
        default: 'all'
        type: choice
        options:
          - all
          - syntax
          - permissions
          - security
          - deployment
          - dependencies
          - performance
          - documentation
  push:
    branches:
      - main
    paths:
      - '.github/workflows/**'
      - '.github/actions-config/**'
  schedule:
    - cron: '0 12 * * *'  # æ¯å¤©ä¸­åˆ12ç‚¹è¿è¡?
permissions:
  contents: write
  actions: read
  pull-requests: read
  checks: read
  deployments: read
  issues: read
  packages: read
  repository-projects: read
  security-events: write
  statuses: read

jobs:
  analyze-and-fix:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    concurrency:
      group: ${{ github.workflow }}-${{ github.ref }}
      cancel-in-progress: true
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.PAT || secrets.GITHUB_TOKEN }}

      - name: Cache npm dependencies
        uses: actions/cache@v4
        with:
          path: ~/.npm
          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-

      - name: Cache pip dependencies
        uses: actions/cache@v4
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements*.txt') }}
          restore-keys: |
            ${{ runner.os }}-pip-

      - name: Set up Node.js
        uses: actions/setup-node@v5
        with:
          node-version: '20'

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install yq pyyaml requests
          npm install -g yaml-lint

      - name: Validate actions-config directory
        run: |
          if [ ! -d ".github/actions-config" ]; then
            echo "Creating actions-config directory..."
            mkdir -p .github/actions-config
          fi
          
          if [ ! -f ".github/actions-config/actions.yaml" ]; then
            echo "Creating actions.yaml file..."
            printf 'allowed_sources:\n  - actions/checkout\n  - actions/setup-node\n  - actions/setup-python\n  - actions/cache\n  - actions/upload-artifact\n  - actions/download-artifact\n  - github/codeql-action\n  - actions/dependency-review-action\n  - reviewdog/reviewdog\n  - codecov/codecov-action\n  - 8398a7/action-slack\n  - actions/github-script\n\ninstalled_actions:\n  - name: actions/checkout\n    version: v4\n    source: actions/checkout\n    usage: æ¯å¤©ä½¿ç”¨\n    security: å·²å®¡æ ¸\n    workflows: []\n\ncustom_actions:\n  directory: ".github/actions"\n  list: []\n' > .github/actions-config/actions.yaml
          fi

      - name: Fix workflow syntax errors
        if: ${{ github.event.inputs.fix-type == 'all' || github.event.inputs.fix-type == 'syntax' }}
        uses: reviewdog/reviewdog@v0.16.0
        with:
          reporter: github-pr-review
          level: error
          workdir: .github/workflows/

      - name: Fix expression syntax
        if: ${{ github.event.inputs.fix-type == 'all' || github.event.inputs.fix-type == 'syntax' }}
        run: |
          for file in .github/workflows/*.yml .github/workflows/*.yaml; do
            if grep -q 'if: steps\.' "$file"; then
              echo "Fixing expression syntax in $file..."
              sed -i 's/if: steps\./if: \${{ steps\. }}/g' "$file"
              sed -i 's/!= \'\'/ != \'\' }}/g' "$file"
            fi
          done

      - name: Fix permission issues
        if: ${{ github.event.inputs.fix-type == 'all' || github.event.inputs.fix-type == 'permissions' }}
        run: |
          for file in .github/workflows/*.yml .github/workflows/*.yaml; do
            echo "Checking permissions in $file..."
            if grep -q 'permissions: {}' "$file"; then
              echo "Fixing empty permissions in $file..."
              sed -i 's/permissions: {}/permissions:\n  contents: read\n  actions: read\n  pull-requests: read\n  checks: read\n  deployments: read\n  issues: read\n  packages: read\n  repository-projects: read\n  security-events: read\n  statuses: read/g' "$file"
            fi
            if ! grep -q 'permissions:' "$file"; then
              echo "Adding basic permissions to $file..."
              sed -i '/jobs:/i \permissions:\n  contents: read\n  actions: read\n  pull-requests: read\n  checks: read\n  deployments: read\n  issues: read\n  packages: read\n  repository-projects: read\n  security-events: read\n  statuses: read\n' "$file"
            fi
          done

      - name: Run security scan
        if: ${{ github.event.inputs.fix-type == 'all' || github.event.inputs.fix-type == 'security' }}
        uses: github/codeql-action/init@v3
        with:
          languages: javascript, python, go
          queries: security-extended,security-and-quality
          setup-python-dependencies: true

      - name: Analyze code
        if: ${{ github.event.inputs.fix-type == 'all' || github.event.inputs.fix-type == 'security' }}
        uses: github/codeql-action/analyze@v3
        with:
          category: /language:javascript,/language:python,/language:go

      - name: Dependency review
        if: ${{ github.event.inputs.fix-type == 'all' || github.event.inputs.fix-type == 'dependencies' || github.event.inputs.fix-type == 'security' }}
        uses: actions/dependency-review-action@v4
        with:
          fail-on-severity: high
          allow-licenses: MIT,Apache-2.0,BSD-3-Clause

      - name: Scan for secrets
        if: ${{ github.event.inputs.fix-type == 'all' || github.event.inputs.fix-type == 'security' }}
        uses: gitleaks/gitleaks-action@v2
        with:
          config-path: .gitleaks.toml
          fail-on-findings: true
          verbose: true

      - name: Update Action versions
        if: ${{ github.event.inputs.fix-type == 'all' || github.event.inputs.fix-type == 'dependencies' }}
        run: |
          for file in .github/workflows/*.yml .github/workflows/*.yaml; do
            echo "Updating Action versions in $file..."
            sed -i 's/actions\/checkout@v[0-9]\+/actions\/checkout@v4/g' "$file"
            sed -i 's/actions\/setup-node@v[0-9]\+/actions\/setup-node@v5/g' "$file"
            sed -i 's/actions\/setup-python@v[0-9]\+/actions\/setup-python@v5/g' "$file"
            sed -i 's/actions\/cache@v[0-9]\+/actions\/cache@v4/g' "$file"
            sed -i 's/actions\/upload-artifact@v[0-9]\+/actions\/upload-artifact@v4/g' "$file"
            sed -i 's/actions\/download-artifact@v[0-9]\+/actions\/download-artifact@v4/g' "$file"
          done

      - name: Optimize workflow performance
        if: ${{ github.event.inputs.fix-type == 'all' || github.event.inputs.fix-type == 'performance' }}
        run: |
          for file in .github/workflows/*.yml .github/workflows/*.yaml; do
            echo "Optimizing performance in $file..."
            if ! grep -q 'actions/cache' "$file"; then
              if grep -q 'actions/setup-node' "$file"; then
                sed -i '/actions\/setup-node@v5/a \      - name: Cache npm dependencies\n        uses: actions/cache@v4\n        with:\n          path: ~/.npm\n          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}\n          restore-keys: |\n            ${{ runner.os }}-node-\n' "$file"
              fi
              if grep -q 'actions/setup-python' "$file"; then
                sed -i '/actions\/setup-python@v5/a \      - name: Cache pip dependencies\n        uses: actions/cache@v4\n        with:\n          path: ~/.cache/pip\n          key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements*.txt') }}\n          restore-keys: |\n            ${{ runner.os }}-pip-\n' "$file"
              fi
            fi
            if ! grep -q 'timeout-minutes' "$file"; then
              sed -i '/runs-on:/a \    timeout-minutes: 30\n' "$file"
            fi
          done

      - name: Update documentation
        if: ${{ github.event.inputs.fix-type == 'all' || github.event.inputs.fix-type == 'documentation' }}
        run: |
          if [ -f ".github/WORKFLOWS_DOCUMENTATION.md" ]; then
            echo "Updating workflow documentation..."
            TODAY=$(date +"%Y-%m-%d")
            sed -i "s/date: [0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\}/date: $TODAY/g" ".github/WORKFLOWS_DOCUMENTATION.md"
          else
            echo "Creating workflow documentation..."
            TODAY=$(date +"%Y-%m-%d")
            echo '# å·¥ä½œæµæ–‡æ¡? > .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '## æ–‡æ¡£ä¿¡æ¯' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **ç‰ˆæœ¬**: v1.2' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo "- **åˆ›å»ºæ—¥æœŸ**: ${TODAY}" >> .github/WORKFLOWS_DOCUMENTATION.md
            echo "- **æ›´æ–°æ—¥æœŸ**: ${TODAY}" >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **ä½œè€?*: GitHub Actions' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '## ç›®å½•ç»“æž„' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '### .github ç›®å½•' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **actions/**: è‡ªå®šä¹?Action' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **actions-config/**: Actions é…ç½®æ–‡ä»¶' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **workflows/**: å·¥ä½œæµæ–‡ä»? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **scripts/**: è¾…åŠ©è„šæœ¬' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '## å·¥ä½œæµåˆ†ç±? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '### CI/CD å·¥ä½œæµ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **ci.yml**: CI å·¥ä½œæµ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **ci@backend.yml**: åŽç«¯ CI å·¥ä½œæµ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **ci@main.yml**: ä¸»åˆ†æ”?CI å·¥ä½œæµ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **deploy.yml**: éƒ¨ç½²å·¥ä½œæµ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **release.yml**: å‘å¸ƒå·¥ä½œæµ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '### æµ‹è¯•å·¥ä½œæµ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **deno.yml**: Deno æµ‹è¯•å·¥ä½œæµ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **idl.yaml**: IDL æµ‹è¯•å·¥ä½œæµ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '### å®‰å…¨å·¥ä½œæµ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **security-scan.yml**: å®‰å…¨æ‰«æå·¥ä½œæµ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **license-check.yaml**: è®¸å¯è¯æ£€æŸ¥å·¥ä½œæµ' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '### å…¶ä»–å·¥ä½œæµ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **claude.yml**: Claude PR åŠ©æ‰‹å·¥ä½œæµ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **workflow-fixer.yml**: å·¥ä½œæµä¿®å¤å·¥ä½œæµ' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '## Actions é…ç½®' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '### å…è®¸çš„æ¥æº? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- actions/checkout' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- actions/setup-node' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- actions/setup-python' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- actions/cache' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- actions/upload-artifact' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- actions/download-artifact' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- github/codeql-action' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- actions/dependency-review-action' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- reviewdog/reviewdog' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- codecov/codecov-action' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- 8398a7/action-slack' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- actions/github-script' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '### å·²å®‰è£…çš„ Actions' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **actions/checkout@v4**: åŸºç¡€ä»£ç æ£€å‡? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **actions/setup-node@v5**: Node.js çŽ¯å¢ƒè®¾ç½®' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **actions/setup-python@v5**: Python çŽ¯å¢ƒè®¾ç½®' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **actions/cache@v4**: ä¾èµ–ç¼“å­˜' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **actions/upload-artifact@v4**: ä¸Šä¼ æž„å»ºäº§ç‰©' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **actions/download-artifact@v4**: ä¸‹è½½æž„å»ºäº§ç‰©' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **github/codeql-action@v3**: ä»£ç å®‰å…¨æ‰«æ' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **actions/dependency-review-action@v4**: ä¾èµ–å®‰å…¨æ£€æŸ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **reviewdog/reviewdog@v0.16.0**: ä»£ç è´¨é‡æ£€æŸ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **codecov/codecov-action@v4**: æµ‹è¯•è¦†ç›–çŽ‡æŠ¥å‘? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **8398a7/action-slack@v3**: å·¥ä½œæµé€šçŸ¥' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **actions/github-script@v7**: GitHub API è„šæœ¬' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '### è‡ªå®šä¹?Actions' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- **action-fixer**: è‡ªåŠ¨æ£€æµ‹å’Œä¿®å¤å·¥ä½œæµé”™è¯? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '## å®‰å…¨ç­–ç•¥' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '### ç‰ˆæœ¬ç®¡ç†' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- å¼ºåˆ¶ä½¿ç”¨å›ºå®šç‰ˆæœ¬å? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- å®šæœŸæ£€æŸ¥å®‰å…¨æ›´æ–? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- é¿å…ä½¿ç”¨ `@master` æˆ?`@latest`' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '### æƒé™ç®¡ç†' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- æœ€å°æƒé™åŽŸåˆ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- æ˜Žç¡®çš„æƒé™é…ç½? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- å®šæœŸæƒé™å®¡è®¡' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '### ä¾èµ–ç®¡ç†' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- å®šæœŸæ›´æ–°ä¾èµ–' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- ä¾èµ–å®‰å…¨æ‰«æ' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- é¿å…ä½¿ç”¨æœ‰æ¼æ´žçš„ä¾èµ–' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '## ä½¿ç”¨å»ºè®®' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '### CI å·¥ä½œæµ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- å¢žé‡æž„å»º' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- å¹¶è¡Œæµ‹è¯•' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- ç¼“å­˜ä¼˜åŒ–' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '### éƒ¨ç½²å·¥ä½œæµ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- å®‰å…¨æ‰«æ' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- éƒ¨ç½²å‰æ£€æŸ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- éƒ¨ç½²åŽéªŒè¯? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '### å®‰å…¨å·¥ä½œæµ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- å®šæœŸæ‰«æ' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- åŠæ—¶ä¿®å¤æ¼æ´ž' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '- å®‰å…¨æŠ¥å‘Š' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '## ä¼˜åŒ–æ–¹å‘' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '1. **å·¥ä½œæµæ•´å?*: åˆå¹¶ç›¸ä¼¼çš„å·¥ä½œæµï¼Œå‡å°‘é‡å¤? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '2. **å®‰å…¨å¢žå¼º**: å¢žåŠ æ›´å¤šå®‰å…¨æ£€æŸ¥ç‚¹' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '3. **æ€§èƒ½ä¼˜åŒ–**: è¿›ä¸€æ­¥ä¼˜åŒ–ç¼“å­˜å’Œå¹¶è¡Œæ‰§è¡Œ' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '4. **ç›‘æŽ§å¢žå¼º**: æ·»åŠ æ›´å¤šç›‘æŽ§å’Œé€šçŸ¥' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '5. **è‡ªåŠ¨åŒ–å¢žå¼?*: å¢žåŠ æ›´å¤šè‡ªåŠ¨åŒ–ä¿®å¤åŠŸèƒ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '## æ•…éšœæŽ’é™¤' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '### å¸¸è§é”™è¯¯' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '1. **æƒé™é”™è¯¯**: æ£€æŸ¥å·¥ä½œæµæƒé™é…ç½®' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '2. **è¯­æ³•é”™è¯¯**: ä½¿ç”¨ YAML éªŒè¯å·¥å…·æ£€æŸ¥è¯­æ³? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '3. **ä¾èµ–é”™è¯¯**: æ£€æŸ¥ä¾èµ–é…ç½®å’Œç½‘ç»œè¿žæŽ¥' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '4. **è¶…æ—¶é”™è¯¯**: å¢žåŠ è¶…æ—¶è®¾ç½®æˆ–ä¼˜åŒ–æ‰§è¡Œæ—¶é—? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '### è§£å†³æ–¹æ¡ˆ' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '1. **æƒé™é—®é¢˜**: æ·»åŠ é€‚å½“çš„æƒé™é…ç½? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '2. **è¯­æ³•é—®é¢˜**: ä½¿ç”¨ `reviewdog/reviewdog` è‡ªåŠ¨ä¿®å¤' >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '3. **ä¾èµ–é—®é¢˜**: å¢žåŠ ç¼“å­˜å’Œé‡è¯•æœºåˆ? >> .github/WORKFLOWS_DOCUMENTATION.md
            echo '4. **è¶…æ—¶é—®é¢˜**: ä¼˜åŒ–æ‰§è¡Œæ­¥éª¤å’Œå¢žåŠ è¶…æ—¶è®¾ç½? >> .github/WORKFLOWS_DOCUMENTATION.md
          fi

      - name: Check for changes
        id: check_changes
        run: |
          git diff --quiet || echo "changes=true" >> $GITHUB_OUTPUT

      - name: Get changed files
        id: get_changed_files
        if: ${{ steps.check_changes.outputs.changes == 'true' }}
        run: |
          echo "changed_files=$(git diff --name-only | grep -E '\.github/(workflows|actions-config)/|WORKFLOWS_DOCUMENTATION\.md' | tr '\n' ' ' | sed 's/ $//')" >> $GITHUB_OUTPUT

      - name: Push changes using GitHub API
        if: ${{ steps.check_changes.outputs.changes == 'true' }}
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const repository = process.env.GITHUB_REPOSITORY;
            const branch = 'main';
            
            const changedFiles = `${{ steps.get_changed_files.outputs.changed_files }}`.split(' ').filter(Boolean);
            
            if (changedFiles.length === 0) {
              console.log('No relevant files changed, skipping push');
              return;
            }
            
            console.log(`Pushing changes to ${changedFiles.length} files...`);
            
            for (const file of changedFiles) {
              try {
                const fs = require('fs');
                const content = fs.readFileSync(file, 'utf8');
                
                let sha = undefined;
                try {
                  const { data: existingFile } = await github.rest.repos.getContent({
                    owner: repository.split('/')[0],
                    repo: repository.split('/')[1],
                    path: file,
                    ref: branch
                  });
                  sha = existingFile.sha;
                } catch (error) {
                  console.log("File " + file + " doesn't exist, will create it");
                }
                
                await github.rest.repos.createOrUpdateFileContents({
                  owner: repository.split('/')[0],
                  repo: repository.split('/')[1],
                  path: file,
                  message: 'fix: auto-correct workflow configuration errors',
                  content: Buffer.from(content).toString('base64'),
                  branch: branch,
                  sha: sha
                });
                
                console.log('Successfully updated ' + file);
              } catch (error) {
                console.error('Error updating ' + file + ': ' + error.message);
              }
            }
            
            console.log('All changes pushed successfully!');

      - name: Upload fix report
        uses: actions/upload-artifact@v4
        with:
          name: workflow-fix-report
          path: |
            .github/actions-config/
            .github/WORKFLOWS_DOCUMENTATION.md

      - name: Send notification
        if: ${{ failure() }}
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          channel: '#ci-cd'
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}\n

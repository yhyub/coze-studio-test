# 全局 GitHub 仓库工作流修复指南

## 🎯 功能概述

已创建全局工作流修复工具，可以一次性修复你所有 GitHub 仓库中的工作流错误。

## 🛠️ 工具特性

### 1. 全局修复能力
- **批量处理**：自动检测并修复所有 GitHub 仓库
- **统一标准**：确保所有仓库使用相同的最佳实践
- **自动提交**：修复后自动提交并推送更改

### 2. 支持修复的内容

| 修复类型 | 修复内容 |
|---------|---------|
| **Action 版本** | 将 `actions/checkout@v3` 更新为 `v4` |
| **Node 版本** | 将 `actions/setup-node@v3` 更新为 `v4` |
| **Go 版本** | 将 `actions/setup-go@v4` 更新为 `v5` |
| **权限配置** | 添加缺失的权限配置 |
| **超时设置** | 统一设置为 30 分钟超时 |

## 🚀 使用方法

### 前置条件

1. 安装 GitHub CLI：
   ```bash
   winget install GitHub.cli
   ```

2. 登录 GitHub：
   ```bash
   gh auth login
   ```

3. 配置 SSH 密钥（可选但推荐）

### 运行全局修复

```bash
# 运行全局修复
node global-fixer.js
```

## 📊 修复流程

### 1. 仓库发现
- 使用 GitHub CLI 获取所有仓库
- 支持最多 100 个仓库

### 2. 仓库克隆
- 自动克隆所有仓库到本地 `repos` 目录
- 已存在的仓库会自动更新

### 3. 自动修复
- 遍历所有工作流文件
- 自动检测并修复所有支持的错误类型
- 记录修复日志

### 4. 自动提交
- 修复完成后自动提交更改
- 推送回远程仓库

## 🔒 安全保障

### 1. 只读模式
- 默认仅检查不修改
- 可以通过配置启用自动修复

### 2. 回滚机制
- 所有修改都可以通过 Git 回滚
- 保留完整的提交历史

### 3. 权限控制
- 仅修改 `.github/workflows` 目录下的文件
- 不影响其他代码

## 📝 修复报告

运行完成后会生成详细报告：
```
=== Global Workflow Fix Report ===
Processed 15 repositories
Total fixes applied: 42

Fixes per repository:
  repo1: 5 fixes
  repo2: 3 fixes
  ...
```

## 🎯 最佳实践

### 1. 定期运行
- 每周运行一次全局修复
- 确保所有仓库保持最新状态

### 2. CI 集成
- 在 CI 中添加工作流检查
- 自动阻止有错误的工作流

### 3. 监控
- 关注仓库的 Actions 运行状态
- 及时处理新出现的错误

## 📚 相关文件

- `global-fixer.js` - 全局修复工具
- `workflow-fixer.js` - 单仓库修复工具
- `GLOBAL_FIX_GUIDE.md` - 本指南

## 🤝 支持

如果在使用过程中遇到问题，请：
1. 检查 GitHub CLI 配置
2. 确保有仓库的读写权限
3. 查看错误日志获取详细信息